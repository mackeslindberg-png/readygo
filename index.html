<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Ready Go</title>

<style>
html,body{
  margin:0;
  padding:0;
  min-height:100%;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}

body{
  background:
    linear-gradient(rgba(0,0,0,.75),rgba(0,0,0,.75)),
    url("bg.png") no-repeat center center fixed;
  background-size: cover;
  display:flex;
  align-items:center;
  justify-content:center;
}

.card{
  width:100%;
  max-width:520px;
  background:rgba(255,255,255,.95);
  border-radius:16px;
  padding:16px;
  box-shadow:0 12px 30px rgba(0,0,0,.4);
}

h1{margin:0 0 12px 0}

.row{margin:12px 0}

label{display:flex;gap:8px;align-items:center}

select,button{
  width:100%;
  padding:12px;
  font-size:16px;
  border-radius:12px;
}

button{
  border:none;
  font-weight:700;
  cursor:pointer;
}

.start{background:#111;color:#fff}
.stop{background:#b00020;color:#fff}

.status{margin-top:10px;font-weight:700}
.small{font-size:13px;color:#444}
</style>
</head>

<body>
<div class="card">
  <h1>Ready Go</h1>

  <div class="row">
    <label>Röstläge</label>
    <select id="mode">
      <option value="fast">Snabb</option>
      <option value="mid">Mellan</option>
      <option value="slow">Långsam</option>
    </select>
  </div>

  <div class="row">
    <label><input type="checkbox" id="shuffle"> Shuffle röstläge</label>
  </div>

  <div class="row">
    <label>Startfördröjning</label>
    <label><input type="radio" name="delay" value="2-4" checked> 2–4 sek</label>
    <label><input type="radio" name="delay" value="3-6"> 3–6 sek</label>
  </div>

  <div class="row">
    <label><input type="checkbox" id="repeat"> Repetera (3–6 sek)</label>
  </div>

  <div class="status" id="status">Status: redo</div>

  <div class="row">
    <button id="btn" class="start">START</button>
  </div>

  <div class="small">Första trycket låser upp ljud i mobilen.</div>
</div>

<script>
const audio = {
  ready: new Audio("ready.mp3"),
  go: new Audio("go.mp3"),
  mid: new Audio("ready_mid.mp3")
};

Object.values(audio).forEach(a=>{
  a.preload="auto";
  a.playsInline=true;
});

let running=false;
let timer=null;

function rand(min,max){
  return Math.floor(Math.random()*(max-min+1))+min;
}

function pickMode(){
  if(!document.getElementById("shuffle").checked){
    return document.getElementById("mode").value;
  }
  return ["fast","mid","slow"][rand(0,2)];
}

function stopAll(){
  Object.values(audio).forEach(a=>{
    a.pause();
    a.currentTime=0;
  });
}

async function playOnce(){
  stopAll();
  const mode = pickMode();

  if(mode==="mid"){
    await audio.mid.play();
    return;
  }

  await audio.ready.play();

  const pause =
    mode==="fast" ? 120 : 1600;

  await new Promise(r=>setTimeout(r,pause));
  await audio.go.play();
}

async function loop(){
  if(!running) return;

  await playOnce();

  if(!document.getElementById("repeat").checked){
    stop();
    return;
  }

  timer=setTimeout(loop,rand(3000,6000));
}

function start(){
  running=true;
  btn.textContent="STOPP";
  btn.className="stop";

  // iOS / Android audio unlock
  audio.ready.volume=0;
  audio.ready.play().then(()=>{
    audio.ready.pause();
    audio.ready.currentTime=0;
    audio.ready.volume=1;
  });

  const d = document.querySelector('input[name="delay"]:checked').value;
  const wait = d==="2-4" ? rand(2000,4000) : rand(3000,6000);

  document.getElementById("status").textContent =
    "Start om " + Math.round(wait/1000) + " sek";

  timer=setTimeout(loop,wait);
}

function stop(){
  running=false;
  clearTimeout(timer);
  stopAll();
  btn.textContent="START";
  btn.className="start";
  document.getElementById("status").textContent="Status: redo";
}

const btn=document.getElementById("btn");
btn.onclick=()=> running ? stop() : start();
</script>
</body>
</html>
